{
  "version": "v1.1",
  "description": "Regras com Guardas Ativas",
  "rules": [
    {
      "id": "R_APPLY_DISCOUNT",
      "phase": "baseline",
      "logic": {
        "*": [
          { "var": "order.baseValue" },
          { "-": [1, { "var": "order.discountPercentage" }] }
        ]
      },
      "output_key": "order.baseValue"
    },
    {
      "id": "R_TAX_VAT",
      "phase": "taxes",
      "logic": { "*": [0.20, { "var": "order.baseValue" }] },
      "output_key": "order.appliedTaxes.VAT"
    },
    {
      "id": "R_GUARD_MAX_DISCOUNT",
      "phase": "guards",
      "logic": { ">": [{ "var": "order.discountPercentage" }, 0.15] },
      "output_key": "Guard_DiscountExcessive",
      "error_message": "O desconto aplicado excede o limite comercial permitido de 15%."
    },
    {
      "id": "R_GUARD_MIN_VALUE",
      "phase": "guards",
      "logic": { "<": [{ "var": "order.baseValue" }, 50.0] },
      "output_key": "Guard_ValueTooLow",
      "error_message": "O valor líquido do pedido está abaixo do faturamento mínimo de 50.00."
    }
  ]
}